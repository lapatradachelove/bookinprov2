<!doctype html>
<html lang="th">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BookinPro - ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    body {
      box-sizing: border-box;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
      width: 100%;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    .app-container {
      height: 100%;
      width: 100%;
      overflow-y: auto;
      background: #3261e9;
    }

    /* ==================== AUTH SCREEN ==================== */
    .auth-screen {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100%;
      padding: 20px;
      background: linear-gradient(135deg, #3261e9 0%, #1e3a8a 100%);
    }

    .auth-card {
      background: white;
      border-radius: 16px;
      padding: 48px 40px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
      width: 100%;
      max-width: 420px;
    }

    .auth-logo {
      text-align: center;
      margin-bottom: 32px;
    }

    .auth-logo h1 {
      font-size: 32px;
      font-weight: 700;
      color: #3261e9;
      margin-bottom: 8px;
    }

    .auth-logo p {
      color: #64748b;
      font-size: 14px;
    }

    .auth-header {
      text-align: center;
      margin-bottom: 24px;
    }

    .lang-toggle-auth {
      position: relative;
      width: 100px;
      height: 40px;
      background: #f1f5f9;
      border-radius: 20px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: space-between;
      padding: 4px;
      transition: all 0.3s;
      margin: 0 auto;
    }

    .lang-toggle-auth .lang-option {
      flex: 1;
      text-align: center;
      font-size: 14px;
      font-weight: 600;
      color: #64748b;
      z-index: 2;
      transition: color 0.3s;
      line-height: 32px;
    }

    .lang-toggle-auth .lang-option.active {
      color: white;
    }

    .lang-toggle-auth .slider {
      position: absolute;
      top: 4px;
      left: 4px;
      width: 46px;
      height: 32px;
      background: #3261e9;
      border-radius: 16px;
      transition: transform 0.3s ease;
      z-index: 1;
    }

    .lang-toggle-auth.en .slider {
      transform: translateX(46px);
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: #1e293b;
      font-weight: 500;
      font-size: 14px;
    }

    .form-group input,
    .form-group select {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-size: 15px;
      transition: all 0.3s;
      background: #f8fafc;
    }

    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: #3261e9;
      background: white;
    }

    .btn-primary {
      width: 100%;
      padding: 14px;
      background: #3261e9;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      margin-top: 8px;
    }

    .btn-primary:hover {
      background: #2451d4;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(50, 97, 233, 0.4);
    }

    .btn-secondary {
      width: 100%;
      padding: 14px;
      background: transparent;
      color: #3261e9;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 12px;
      transition: all 0.3s;
    }

    .btn-secondary:hover {
      background: #f8fafc;
      border-color: #3261e9;
    }

    .debug-info {
      margin-top: 20px;
      padding: 12px;
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      font-size: 12px;
      color: #64748b;
    }

    .debug-info h4 {
      margin-bottom: 8px;
      color: #1e293b;
      font-size: 13px;
    }

    .debug-info pre {
      background: white;
      padding: 8px;
      border-radius: 4px;
      overflow-x: auto;
      font-size: 11px;
      max-height: 200px;
      overflow-y: auto;
    }

    /* ==================== MAIN SCREEN ==================== */
    .main-screen {
      display: none;
      min-height: 100%;
      background: #3261e9;
    }

    /* Navbar */
    .navbar {
      background: white;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    .navbar-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 16px 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 20px;
    }

    .navbar-brand {
      font-size: 24px;
      font-weight: 700;
      color: #3261e9;
    }

    .navbar-menu {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      flex: 1;
      justify-content: center;
    }

    .nav-item {
      padding: 10px 20px;
      background: transparent;
      color: #64748b;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      white-space: nowrap;
    }

    .nav-item:hover {
      background: #f1f5f9;
      color: #3261e9;
    }

    .nav-item.active {
      background: #3261e9;
      color: white;
    }

    .navbar-actions {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .lang-toggle {
      position: relative;
      width: 100px;
      height: 40px;
      background: #f1f5f9;
      border-radius: 20px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: space-between;
      padding: 4px;
      transition: all 0.3s;
    }

    .lang-toggle .lang-option {
      flex: 1;
      text-align: center;
      font-size: 14px;
      font-weight: 600;
      color: #64748b;
      z-index: 2;
      transition: color 0.3s;
      line-height: 32px;
    }

    .lang-toggle .lang-option.active {
      color: white;
    }

    .lang-toggle .slider {
      position: absolute;
      top: 4px;
      left: 4px;
      width: 46px;
      height: 32px;
      background: #3261e9;
      border-radius: 16px;
      transition: transform 0.3s ease;
      z-index: 1;
    }

    .lang-toggle.en .slider {
      transform: translateX(46px);
    }

    .btn-logout {
      padding: 8px 20px;
      background: #ef4444;
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s;
      white-space: nowrap;
    }

    .btn-logout:hover {
      background: #dc2626;
    }

    /* Content */
    .content-wrapper {
      max-width: 1400px;
      margin: 0 auto;
      padding: 32px 24px;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* Card */
    .card {
      background: white;
      border-radius: 12px;
      padding: 32px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
      margin-bottom: 24px;
    }

    .card-title {
      font-size: 18px;
      font-weight: 600;
      color: #1e293b;
      margin-bottom: 24px;
    }

    /* Two Column Layout */
    .two-column-layout {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      align-items: start;
    }

    /* Room/Meeting Selection */
    .room-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 32px;
    }

    .room-card {
      padding: 24px;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      background: #f8fafc;
    }

    .room-card:hover {
      border-color: #3261e9;
      background: white;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(50, 97, 233, 0.1);
    }

    .room-card.selected {
      border-color: #3261e9;
      background: #eff6ff;
    }

    .room-name {
      font-weight: 600;
      color: #1e293b;
      font-size: 16px;
    }

    /* Form */
    .booking-form {
      display: none;
      animation: fadeIn 0.3s;
    }

    .booking-form.show {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 24px;
    }

    .form-group-inline {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    .time-input-group {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .time-input-group select {
      flex: 1;
    }

    .time-input-group input[type="time"] {
      width: 120px;
    }

    textarea {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-size: 15px;
      font-family: inherit;
      transition: all 0.3s;
      background: #f8fafc;
      min-height: 80px;
      resize: vertical;
    }

    textarea:focus {
      outline: none;
      border-color: #3261e9;
      background: white;
    }

    /* Today's Bookings */
    .booking-list {
      display: grid;
      gap: 16px;
    }

    .booking-item {
      background: #f8fafc;
      border-left: 4px solid #3261e9;
      border-radius: 8px;
      padding: 20px;
      transition: all 0.3s;
    }

    .booking-item:hover {
      background: white;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    .booking-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 16px;
      flex-wrap: wrap;
      gap: 12px;
    }

    .booking-room {
      font-size: 18px;
      font-weight: 600;
      color: #1e293b;
    }

    .booking-time {
      background: #3261e9;
      color: white;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 600;
    }

    .booking-details {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
      color: #64748b;
      font-size: 14px;
    }

    .booking-detail-item {
      display: flex;
      gap: 8px;
    }

    .booking-detail-item strong {
      color: #1e293b;
    }

    .btn-cancel {
      margin-top: 16px;
      padding: 8px 16px;
      background: #ef4444;
      color: white;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s;
    }

    .btn-cancel:hover {
      background: #dc2626;
    }

    .no-bookings {
      text-align: center;
      padding: 60px 20px;
      color: #94a3b8;
    }

    .no-bookings p {
      font-size: 16px;
    }

    /* All Bookings Page */
    .fullscreen-btn-container {
      display: flex;
      justify-content: flex-end;
      margin-bottom: 24px;
    }

    .fullscreen-btn {
      padding: 12px 24px;
      background: #3261e9;
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .fullscreen-btn:hover {
      background: #2451d4;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(50, 97, 233, 0.3);
    }

    /* Fullscreen View */
    .fullscreen-view {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #3261e9 0%, #1e3a8a 100%);
      z-index: 9999;
      overflow-y: auto;
    }

    .fullscreen-view.active {
      display: block;
    }

    .fullscreen-header {
      text-align: center;
      padding: 48px 24px 32px;
      color: white;
    }

    .fullscreen-header h1 {
      font-size: 40px;
      font-weight: 700;
      margin-bottom: 12px;
    }

    .fullscreen-header p {
      font-size: 16px;
      opacity: 0.9;
      margin-bottom: 20px;
    }

    .fullscreen-header .divider {
      width: 200px;
      height: 3px;
      background: linear-gradient(90deg, #60a5fa 0%, #3b82f6 50%, #2563eb 100%);
      margin: 0 auto;
      box-shadow: 0 2px 8px rgba(96, 165, 250, 0.5);
    }

    .container-icon {
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #3261e9 0%, #1e3a8a 100%);
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(50, 97, 233, 0.3);
    }

    .container-icon svg {
      width: 20px;
      height: 20px;
      fill: white;
    }

    .fullscreen-content {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 24px 48px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 32px;
    }
    
    /* Force two columns even on small screens for fullscreen view */
    @media (max-width: 768px) {
      .fullscreen-content {
        grid-template-columns: 1fr 1fr;
        gap: 16px;
        padding: 0 12px 24px;
      }
    }

    .fullscreen-container {
      background: white;
      border-radius: 16px;
      padding: 32px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
    }

    .fullscreen-container-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 2px solid #e2e8f0;
    }

    .fullscreen-container-header h2 {
      font-size: 24px;
      font-weight: 700;
      color: #1e293b;
    }

    /* User History Profile */
    .user-profile {
      background: white;
      border-radius: 12px;
      padding: 32px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
      margin-bottom: 24px;
      text-align: center;
    }

    .profile-avatar-container {
      position: relative;
      width: 120px;
      height: 120px;
      margin: 0 auto 20px;
    }

    .profile-avatar {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: linear-gradient(135deg, #3261e9 0%, #1e3a8a 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 48px;
      font-weight: 700;
      box-shadow: 0 4px 12px rgba(50, 97, 233, 0.3);
      overflow: hidden;
      cursor: pointer;
      transition: all 0.3s;
    }

    .profile-avatar:hover {
      box-shadow: 0 6px 16px rgba(50, 97, 233, 0.5);
      transform: scale(1.05);
    }

    .profile-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .profile-avatar-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.3s;
      cursor: pointer;
      color: white;
      font-size: 14px;
      font-weight: 600;
      pointer-events: none;
    }

    .profile-avatar-container:hover .profile-avatar-overlay {
      opacity: 1;
      pointer-events: auto;
    }

    #profileImageInput {
      display: none;
    }

    .profile-name {
      font-size: 24px;
      font-weight: 700;
      color: #1e293b;
      margin-bottom: 8px;
    }

    .profile-email {
      font-size: 16px;
      color: #64748b;
      margin-bottom: 4px;
    }

    .profile-login-email {
      font-size: 14px;
      color: #94a3b8;
    }

    .btn-submit {
      width: 100%;
      padding: 16px;
      background: #3261e9;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      margin-top: 8px;
    }

    .btn-submit:hover {
      background: #2451d4;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(50, 97, 233, 0.4);
    }

    .hidden {
      display: none !important;
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .two-column-layout {
        display: block;
      }
      
      .two-column-layout > .card {
        margin-bottom: 24px;
      }
    }

    @media (max-width: 768px) {
      .navbar-container {
        flex-direction: column;
        gap: 16px;
      }

      .navbar-menu {
        width: 100%;
        justify-content: flex-start;
        overflow-x: auto;
      }

      .navbar-actions {
        width: 100%;
        justify-content: space-between;
      }

      .form-grid {
        grid-template-columns: 1fr;
      }

      .fullscreen-header h1 {
        font-size: 32px;
      }

      .fullscreen-header p {
        font-size: 16px;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="app-container" id="appContainer"><!-- Login/Register Screen -->
   <div class="auth-screen" id="authScreen">
    <div class="auth-card">
     <div class="auth-logo">
      <h1 data-i18n="appName">BookinPro</h1>
      <p data-i18n="appTagline">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢</p>
     </div>
     <div class="auth-header">
      <div class="lang-toggle-auth" id="langToggleAuth">
       <div class="slider"></div>
       <div class="lang-option active" data-lang="th">
        TH
       </div>
       <div class="lang-option" data-lang="en">
        EN
       </div>
      </div>
     </div>
     <form id="authForm">
      <div class="form-group hidden" id="fullnameGroup"><label for="fullname" data-i18n="fullName">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label> <input type="text" id="fullname" data-i18n-placeholder="enterFullName">
      </div>
      <div class="form-group hidden" id="emailGroup"><label for="email" data-i18n="email">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label> <input type="email" id="email" data-i18n-placeholder="enterEmail">
      </div>
      <div class="form-group"><label for="username" data-i18n="username">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label> <input type="text" id="username" data-i18n-placeholder="enterUsername" required>
      </div>
      <div class="form-group"><label for="password" data-i18n="password">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label> <input type="password" id="password" data-i18n-placeholder="enterPassword" required>
      </div><button type="submit" class="btn-primary" id="authSubmitBtn" data-i18n="login">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button> <button type="button" class="btn-secondary" id="toggleAuthBtn" data-i18n="register">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</button>
     </form><!-- Debug Info -->
     <div class="debug-info" id="debugInfo" style="display: none;">
      <h4>üîç Debug Information (Open Console for more details)</h4>
      <pre id="debugOutput">Waiting for login attempt...</pre>
     </div>
    </div>
   </div><!-- Main App Screen -->
   <div class="main-screen" id="mainScreen"><!-- Navbar -->
    <nav class="navbar">
     <div class="navbar-container">
      <div class="navbar-brand">
       BookinPro
      </div>
      <div class="navbar-menu"><button class="nav-item active" data-tab="room-booking" data-i18n="roomBooking">‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</button> <button class="nav-item" data-tab="appointment" data-i18n="appointment">‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢</button> <button class="nav-item" data-tab="all-bookings" data-i18n="allBookings">‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button> <button class="nav-item" data-tab="user-activity" data-i18n="userActivity">‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</button> <button class="nav-item" data-tab="user-history" data-i18n="userHistory">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</button>
      </div>
      <div class="navbar-actions">
       <div class="lang-toggle" id="langToggle">
        <div class="slider"></div>
        <div class="lang-option active" data-lang="th">
         TH
        </div>
        <div class="lang-option" data-lang="en">
         EN
        </div>
       </div><button class="btn-logout" id="logoutBtn" data-i18n="logout">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
      </div>
     </div>
    </nav>
    <div class="content-wrapper"><!-- Room Booking Tab -->
     <div class="tab-content active" id="roomBookingTab">
      <div class="two-column-layout"><!-- Left: Room Selection & Form -->
       <div class="card">
        <div class="card-title" data-i18n="selectRoom">
         ‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°
        </div>
        <div class="room-grid" id="roomSelector">
         <div class="room-card" data-room="large" data-name-th="‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡πÉ‡∏´‡∏ç‡πà" data-name-en="Large Meeting Room">
          <div class="room-name" data-i18n="roomLarge">
           ‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡πÉ‡∏´‡∏ç‡πà
          </div>
         </div>
         <div class="room-card" data-room="small" data-name-th="‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡πÄ‡∏•‡πá‡∏Å" data-name-en="Small Meeting Room">
          <div class="room-name" data-i18n="roomSmall">
           ‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡πÄ‡∏•‡πá‡∏Å
          </div>
         </div>
         <div class="room-card" data-room="vip" data-name-th="‡∏´‡πâ‡∏≠‡∏á VIP" data-name-en="VIP Room">
          <div class="room-name" data-i18n="roomVIP">
           ‡∏´‡πâ‡∏≠‡∏á VIP
          </div>
         </div>
         <div class="room-card" data-room="executive" data-name-th="‡∏´‡πâ‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£ (Mr.Huang)" data-name-en="Executive Room (Mr.Huang)">
          <div class="room-name" data-i18n="roomExecutive">
           ‡∏´‡πâ‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£ (Mr.Huang)
          </div>
         </div>
        </div>
        <form id="roomBookingForm" class="booking-form">
         <div class="form-grid">
          <div class="form-group"><label for="roomDate" data-i18n="date">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label> <input type="date" id="roomDate" required>
          </div>
          <div class="form-group"><label for="roomStartTime" data-i18n="startTime">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°</label>
           <div class="time-input-group"><select id="roomStartTimeSelect"> <option value="" data-i18n-option="selectTime">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤ --</option> </select> <input type="time" id="roomStartTime" required>
           </div>
          </div>
          <div class="form-group"><label for="roomEndTime" data-i18n="endTime">‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</label>
           <div class="time-input-group"><select id="roomEndTimeSelect"> <option value="" data-i18n-option="selectTime">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤ --</option> </select> <input type="time" id="roomEndTime" required>
           </div>
          </div>
          <div class="form-group"><label for="roomBooker" data-i18n="bookerName">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á</label> <input type="text" id="roomBooker" required>
          </div>
          <div class="form-group"><label for="roomUser" data-i18n="userName">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡πâ‡∏≠‡∏á</label> <input type="text" id="roomUser" required>
          </div>
          <div class="form-group"><label for="roomNotes" data-i18n="notes">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label> <textarea id="roomNotes" rows="3"></textarea>
          </div>
         </div><button type="submit" class="btn-submit" data-i18n="confirmBooking">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</button>
        </form>
       </div><!-- Right: Today's Room Bookings - Decreased 5% -->
       <div class="card">
        <div class="card-title" data-i18n="todayRoomBookings">
         ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°
        </div>
        <div class="booking-list" id="todayRoomBookings" style="transform: scale(0.95); transform-origin: top left; width: 105.26%; margin-bottom: -5%;">
         <div class="no-bookings">
          <p data-i18n="noRoomBookings">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</p>
         </div>
        </div>
       </div>
      </div>
     </div><!-- Appointment Tab -->
     <div class="tab-content" id="appointmentTab">
      <div class="two-column-layout"><!-- Left: Appointment Form -->
       <div class="card">
        <div class="card-title" data-i18n="appointmentForm">
         ‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢
        </div>
        <form id="appointmentForm">
         <div class="form-grid">
          <div class="form-group"><label for="apptDate" data-i18n="date">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label> <input type="date" id="apptDate" required>
          </div>
          <div class="form-group"><label for="apptTime" data-i18n="time">‡πÄ‡∏ß‡∏•‡∏≤</label>
           <div class="time-input-group"><select id="apptTimeSelect"> <option value="" data-i18n-option="selectTime">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤ --</option> </select> <input type="time" id="apptTime" required>
           </div>
          </div>
          <div class="form-group"><label for="visitorName" data-i18n="visitorName">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏°‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</label> <input type="text" id="visitorName" required>
          </div>
          <div class="form-group"><label for="visitorCompany" data-i18n="visitorCompany">‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó/‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏π‡πâ‡∏°‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</label> <input type="text" id="visitorCompany" required>
          </div>
          <div class="form-group"><label for="contactPerson" data-i18n="contactPerson">‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏ó‡∏µ‡πà‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</label> <input type="text" id="contactPerson" required>
          </div>
          <div class="form-group"><label for="apptNotes" data-i18n="notes">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label> <textarea id="apptNotes" rows="3"></textarea>
          </div>
         </div><button type="submit" class="btn-submit" data-i18n="confirmAppointment">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢</button>
        </form>
       </div><!-- Right: Today's Appointments - Decreased 5% -->
       <div class="card">
        <div class="card-title" data-i18n="todayAppointments">
         ‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢
        </div>
        <div class="booking-list" id="todayAppointments" style="transform: scale(0.95); transform-origin: top left; width: 105.26%; margin-bottom: -5%;">
         <div class="no-bookings">
          <p data-i18n="noAppointments">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢</p>
         </div>
        </div>
       </div>
      </div>
     </div><!-- All Bookings Tab -->
     <div class="tab-content" id="allBookingsTab">
      <div class="fullscreen-btn-container"><button class="fullscreen-btn" id="fullscreenBtn"> <span data-i18n="fullscreenView">‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÅ‡∏ö‡∏ö‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠</span> </button>
      </div>
      <div class="two-column-layout"><!-- Left: All Room Bookings -->
       <div class="card">
        <div class="card-title" data-i18n="allRoomBookings">
         ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        </div>
        <div class="booking-list" id="allRoomBookingsList"></div>
       </div><!-- Right: All Appointments -->
       <div class="card">
        <div class="card-title" data-i18n="allAppointmentsList">
         ‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        </div>
        <div class="booking-list" id="allAppointmentsList"></div>
       </div>
      </div>
     </div><!-- User Activity Tab -->
     <div class="tab-content" id="userActivityTab">
      <div class="card">
       <div class="card-title" data-i18n="userActivity">
        ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
       </div>
       <div class="booking-list" id="userActivityList">
        <div class="no-bookings">
         <p data-i18n="noActivity">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</p>
        </div>
       </div>
      </div>
     </div><!-- User History Tab -->
     <div class="tab-content" id="userHistoryTab">
      <div class="user-profile">
       <div class="profile-avatar-container">
        <div class="profile-avatar" id="profileAvatar" onclick="document.getElementById('profileImageInput').click()"><span id="profileInitials">U</span>
        </div>
        <div class="profile-avatar-overlay" onclick="document.getElementById('profileImageInput').click()"><span data-i18n="uploadPhoto">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ</span>
        </div><input type="file" id="profileImageInput" accept="image/*">
       </div>
       <div class="profile-name" id="profileName">
        ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
       </div>
       <div class="profile-email" id="profileEmail">
        user@example.com
       </div>
       <div class="profile-login-email" id="profileLoginEmail">
        Username: username
       </div>
      </div>
      <div class="card">
       <div class="no-bookings">
        <p data-i18n="noHistory">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</p>
       </div>
      </div>
     </div>
    </div>
   </div><!-- Fullscreen View -->
   <div class="fullscreen-view" id="fullscreenView">
    <div class="fullscreen-header">
     <h1>BookinPro</h1>
     <p data-i18n="dashboardSubtitle">Meeting Room Bookings &amp; Appointments System</p>
     <div class="divider"></div>
    </div>
    <div class="fullscreen-content">
     <div class="fullscreen-container">
      <div class="fullscreen-container-header">
       <div class="container-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11z" /> <path d="M7 10h2v2H7zm4 0h2v2h-2zm4 0h2v2h-2z" />
        </svg>
       </div>
       <h2 data-i18n="roomBookings">‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</h2>
      </div>
      <div class="booking-list" id="fullscreenRoomBookings">
       <div class="no-bookings">
        <p data-i18n="noRoomBookings">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</p>
       </div>
      </div>
     </div>
     <div class="fullscreen-container">
      <div class="fullscreen-container-header">
       <div class="container-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24"><path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V9h14v10z" /> <circle cx="12" cy="13" r="1.5" /> <path d="M8 11h2v2H8zm4 0h2v2h-2zm4 0h2v2h-2zm-8 4h2v2H8zm4 0h2v2h-2z" />
        </svg>
       </div>
       <h2 data-i18n="appointments">‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢</h2>
      </div>
      <div class="booking-list" id="fullscreenAppointments">
       <div class="no-bookings">
        <p data-i18n="noAppointments">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢</p>
       </div>
      </div>
     </div>
    </div>
   </div>
  </div>
  <script>
    // =============================================
    // Configuration
    // =============================================
    const CONFIG = {
      APPS_SCRIPT_URL: 'https://script.google.com/macros/s/AKfycbxUPFXx-Z0LDVjZ-DvMBHvBjrGA6PoZC6qx-W2mEWPZXFKJP5qCGX7zVNIAqLkVJLmE-Q/exec',
      SHEET_ID: '1TDhkw343F8KuS-uX0fgBjlA_z2TF1DjPWk7wkodhAqc',
      USER_SHEET_NAME: '‡∏ä‡∏µ‡∏ï6',
      ROOM_SHEET_NAME: '‡∏ä‡∏µ‡∏ï7',
      APPT_SHEET_NAME: '‡∏ä‡∏µ‡∏ï8',
      ACTIVITY_SHEET_NAME: '‡∏ä‡∏µ‡∏ï9'
    };

    function generateTimestamp() {
      const now = new Date();
      const bangkokTime = new Date(now.toLocaleString('en-US', { timeZone: 'Asia/Bangkok' }));
      
      const year = bangkokTime.getFullYear();
      const month = String(bangkokTime.getMonth() + 1).padStart(2, '0');
      const day = String(bangkokTime.getDate()).padStart(2, '0');
      const hours = String(bangkokTime.getHours()).padStart(2, '0');
      const minutes = String(bangkokTime.getMinutes()).padStart(2, '0');
      const seconds = String(bangkokTime.getSeconds()).padStart(2, '0');
      
      const date = `${day}-${month}-${year}`;
      const time = `${hours}:${minutes}:${seconds}`;
      const timestamp = `${date} ${time}`;
      
      return {
        date: date,
        time: time,
        timestamp: timestamp
      };
    }

    const translations = {
      th: {
        appName: 'BookinPro',
        appTagline: '‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢',
        fullName: '‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•',
        enterFullName: '‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•',
        email: '‡∏≠‡∏µ‡πÄ‡∏°‡∏•',
        enterEmail: '‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•',
        username: '‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ',
        enterUsername: '‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ',
        password: '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô',
        enterPassword: '‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô',
        login: '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö',
        register: '‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô',
        logout: '‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö',
        roomBooking: '‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°',
        appointment: '‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢',
        allBookings: '‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î',
        userActivity: '‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ',
        userHistory: '‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ',
        selectRoom: '‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°',
        roomLarge: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡πÉ‡∏´‡∏ç‡πà',
        roomSmall: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡πÄ‡∏•‡πá‡∏Å',
        roomVIP: '‡∏´‡πâ‡∏≠‡∏á VIP',
        roomExecutive: '‡∏´‡πâ‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£ (Mr.Huang)',
        date: '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà',
        startTime: '‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°',
        endTime: '‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î',
        time: '‡πÄ‡∏ß‡∏•‡∏≤',
        selectTime: '-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤ --',
        bookerName: '‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á',
        userName: '‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡πâ‡∏≠‡∏á',
        notes: '‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏',
        confirmBooking: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á',
        todayRoomBookings: '‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°',
        noRoomBookings: '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°',
        appointmentForm: '‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢',
        visitorName: '‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏°‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠',
        visitorCompany: '‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó/‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏π‡πâ‡∏°‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠',
        contactPerson: '‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏ó‡∏µ‡πà‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠',
        confirmAppointment: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢',
        todayAppointments: '‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢',
        noAppointments: '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢',
        fullscreenView: '‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÅ‡∏ö‡∏ö‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠',
        allRoomBookings: '‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î',
        allAppointmentsList: '‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î',
        noActivity: '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°',
        noHistory: '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥',
        dashboardSubtitle: 'Meeting Room Bookings & Appointments System',
        roomBookings: '‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°',
        appointments: '‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢',
        cancel: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
        uploadPhoto: '‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ',
        activityBy: '‡πÇ‡∏î‡∏¢'
      },
      en: {
        appName: 'BookinPro',
        appTagline: 'Meeting Room & Appointment Booking System',
        fullName: 'Full Name',
        enterFullName: 'Enter full name',
        email: 'Email',
        enterEmail: 'Enter email',
        username: 'Username',
        enterUsername: 'Enter username',
        password: 'Password',
        enterPassword: 'Enter password',
        login: 'Login',
        register: 'Register',
        logout: 'Logout',
        roomBooking: 'Room Booking',
        appointment: 'Appointment',
        allBookings: 'All Bookings',
        userActivity: 'User Activity',
        userHistory: 'User History',
        selectRoom: 'Meeting Room Booking Form',
        roomLarge: 'Large Meeting Room',
        roomSmall: 'Small Meeting Room',
        roomVIP: 'VIP Room',
        roomExecutive: 'Executive Room (Mr.Huang)',
        date: 'Date',
        startTime: 'Start Time',
        endTime: 'End Time',
        time: 'Time',
        selectTime: '-- Select Time --',
        bookerName: 'Booker Name',
        userName: 'Room User Name',
        notes: 'Notes',
        confirmBooking: 'Confirm Booking',
        todayRoomBookings: 'Room Bookings',
        noRoomBookings: 'No room bookings',
        appointmentForm: 'Appointment Form',
        visitorName: 'Visitor Name',
        visitorCompany: 'Visitor Company/Organization',
        contactPerson: 'Contact Person',
        confirmAppointment: 'Confirm Appointment',
        todayAppointments: 'Appointments',
        noAppointments: 'No appointments',
        fullscreenView: 'Fullscreen View',
        allRoomBookings: 'All Room Bookings',
        allAppointmentsList: 'All Appointments',
        noActivity: 'No activity yet',
        noHistory: 'No history yet',
        dashboardSubtitle: 'Meeting Room Bookings & Appointments System',
        roomBookings: 'Room Bookings',
        appointments: 'Appointments',
        cancel: 'Cancel',
        uploadPhoto: 'Upload Photo',
        activityBy: 'By'
      }
    };

    let currentLang = 'th';

    // Room name mapping for translation
    const roomNameTranslations = {
      '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡πÉ‡∏´‡∏ç‡πà': { th: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡πÉ‡∏´‡∏ç‡πà', en: 'Large Meeting Room' },
      '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡πÄ‡∏•‡πá‡∏Å': { th: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡πÄ‡∏•‡πá‡∏Å', en: 'Small Meeting Room' },
      '‡∏´‡πâ‡∏≠‡∏á VIP': { th: '‡∏´‡πâ‡∏≠‡∏á VIP', en: 'VIP Room' },
      '‡∏´‡πâ‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£ (Mr.Huang)': { th: '‡∏´‡πâ‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£ (Mr.Huang)', en: 'Executive Room (Mr.Huang)' },
      'Large Meeting Room': { th: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡πÉ‡∏´‡∏ç‡πà', en: 'Large Meeting Room' },
      'Small Meeting Room': { th: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡πÄ‡∏•‡πá‡∏Å', en: 'Small Meeting Room' },
      'VIP Room': { th: '‡∏´‡πâ‡∏≠‡∏á VIP', en: 'VIP Room' },
      'Executive Room (Mr.Huang)': { th: '‡∏´‡πâ‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£ (Mr.Huang)', en: 'Executive Room (Mr.Huang)' }
    };

    function translateRoomName(roomName) {
      if (!roomName) return roomName;
      
      // Check if room name exists in translation map
      if (roomNameTranslations[roomName]) {
        return roomNameTranslations[roomName][currentLang];
      }
      
      // If not found, return original
      return roomName;
    }

    function translateActivityDetails(details) {
      if (!details) return details;
      
      let translatedDetails = details;
      
      // Replace each room name found in details with its translation
      Object.keys(roomNameTranslations).forEach(roomName => {
        if (translatedDetails.includes(roomName)) {
          const translated = roomNameTranslations[roomName][currentLang];
          translatedDetails = translatedDetails.replace(roomName, translated);
        }
      });
      
      return translatedDetails;
    }

    function updateTimeSelectTranslations() {
      const trans = translations[currentLang];
      
      document.querySelectorAll('[data-i18n-option="selectTime"]').forEach(option => {
        option.textContent = trans.selectTime;
      });
    }

    function translatePage() {
      const trans = translations[currentLang];
      
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (trans[key]) {
          el.textContent = trans[key];
        }
      });

      document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
        const key = el.getAttribute('data-i18n-placeholder');
        if (trans[key]) {
          el.placeholder = trans[key];
        }
      });

      updateTimeSelectTranslations();

      // Update room names based on language
      document.querySelectorAll('.room-card').forEach(card => {
        const nameEl = card.querySelector('.room-name');
        if (nameEl) {
          if (currentLang === 'en') {
            const nameEn = card.getAttribute('data-name-en');
            if (nameEn) {
              nameEl.textContent = nameEn;
            }
          } else {
            const nameTh = card.getAttribute('data-name-th');
            if (nameTh) {
              nameEl.textContent = nameTh;
            }
          }
        }
      });
      
      // Update all room bookings displays
      renderTodayRoomBookings();
      renderAllBookings();
      renderFullscreenView();
      renderUserActivities();
    }

    const state = {
      isLoggedIn: false,
      isRegistering: false,
      currentUser: null,
      selectedRoom: null,
      roomBookings: [],
      appointments: [],
      activities: []
    };

    function updateDebugInfo(info) {
      const debugOutput = document.getElementById('debugOutput');
      const debugInfo = document.getElementById('debugInfo');
      
      if (debugOutput) {
        debugOutput.textContent = JSON.stringify(info, null, 2);
        debugInfo.style.display = 'block';
      }
    }

    function formatDateToDDMMYYYY(dateString) {
      if (!dateString) return '';
      
      dateString = String(dateString).trim();
      
      if (dateString.match(/^\d{4}-\d{1,2}-\d{1,2}$/)) {
        const parts = dateString.split('-');
        const day = parts[2].padStart(2, '0');
        const month = parts[1].padStart(2, '0');
        const year = parts[0];
        return `${day}-${month}-${year}`;
      }
      
      if (dateString.match(/^\d{1,2}-\d{1,2}-\d{4}$/)) {
        const parts = dateString.split('-');
        const day = parts[0].padStart(2, '0');
        const month = parts[1].padStart(2, '0');
        const year = parts[2];
        return `${day}-${month}-${year}`;
      }
      
      if (dateString.match(/^\d{1,2}\/\d{1,2}\/\d{4}$/)) {
        const parts = dateString.split('/');
        const day = parts[0].padStart(2, '0');
        const month = parts[1].padStart(2, '0');
        const year = parts[2];
        return `${day}-${month}-${year}`;
      }
      
      const date = new Date(dateString);
      if (!isNaN(date.getTime())) {
        const day = String(date.getDate()).padStart(2, '0');
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const year = date.getFullYear();
        return `${day}-${month}-${year}`;
      }
      
      return dateString;
    }

    function formatTimeToHHMM(timeString) {
      if (!timeString) return '';
      
      timeString = String(timeString).trim();
      
      if (timeString.match(/^\d{1,2}:\d{2}:\d{2}/)) {
        const parts = timeString.split(':');
        const hours = parts[0].padStart(2, '0');
        const minutes = parts[1].padStart(2, '0');
        return `${hours}:${minutes}`;
      }
      
      if (timeString.match(/^\d{1,2}:\d{2}$/)) {
        const parts = timeString.split(':');
        const hours = parts[0].padStart(2, '0');
        const minutes = parts[1].padStart(2, '0');
        return `${hours}:${minutes}`;
      }
      
      if (timeString.match(/^\d{1,2}:\d{1}$/)) {
        const parts = timeString.split(':');
        const hours = parts[0].padStart(2, '0');
        const minutes = parts[1].padStart(2, '0');
        return `${hours}:${minutes}`;
      }
      
      if (!isNaN(timeString) || timeString.includes('T') || timeString.includes('Z')) {
        const date = new Date(timeString);
        if (!isNaN(date.getTime())) {
          const hours = String(date.getHours()).padStart(2, '0');
          const minutes = String(date.getMinutes()).padStart(2, '0');
          return `${hours}:${minutes}`;
        }
      }
      
      return timeString;
    }

    function formatISOTimestamp(isoTimestamp) {
      if (!isoTimestamp) return '';
      
      try {
        // Parse ISO 8601 format (2026-01-05T08:52:47.000Z)
        const date = new Date(isoTimestamp);
        
        if (isNaN(date.getTime())) return isoTimestamp;
        
        // Convert to Bangkok timezone (GMT+7)
        const bangkokTime = new Date(date.toLocaleString('en-US', { timeZone: 'Asia/Bangkok' }));
        
        const day = String(bangkokTime.getDate()).padStart(2, '0');
        const month = String(bangkokTime.getMonth() + 1).padStart(2, '0');
        const year = bangkokTime.getFullYear();
        const hours = String(bangkokTime.getHours()).padStart(2, '0');
        const minutes = String(bangkokTime.getMinutes()).padStart(2, '0');
        const seconds = String(bangkokTime.getSeconds()).padStart(2, '0');
        
        return `${day}-${month}-${year} ${hours}:${minutes}:${seconds}`;
      } catch (error) {
        console.error('Error formatting ISO timestamp:', error, isoTimestamp);
        return isoTimestamp;
      }
    }

    function getCurrentDateGMT7() {
      const now = new Date();
      const bangkokTime = new Date(now.toLocaleString('en-US', { timeZone: 'Asia/Bangkok' }));
      const year = bangkokTime.getFullYear();
      const month = String(bangkokTime.getMonth() + 1).padStart(2, '0');
      const day = String(bangkokTime.getDate()).padStart(2, '0');
      return `${year}-${month}-${day}`;
    }

    function populateTimeOptions() {
      const timeSelects = [
        'roomStartTimeSelect',
        'roomEndTimeSelect',
        'apptTimeSelect'
      ];

      timeSelects.forEach(selectId => {
        const select = document.getElementById(selectId);
        if (!select) return;

        const currentOptions = select.innerHTML;
        if (currentOptions.split('</option>').length > 2) return;

        for (let hour = 8; hour <= 19; hour++) {
          for (let min = 0; min < 60; min += 30) {
            const timeStr = `${String(hour).padStart(2, '0')}:${String(min).padStart(2, '0')}`;
            const option = document.createElement('option');
            option.value = timeStr;
            option.textContent = timeStr;
            select.appendChild(option);
          }
        }
      });
    }

    function getInitials(fullname) {
      if (!fullname) return 'U';
      const parts = fullname.trim().split(' ');
      if (parts.length === 1) {
        return parts[0].charAt(0).toUpperCase();
      }
      return (parts[0].charAt(0) + parts[parts.length - 1].charAt(0)).toUpperCase();
    }

    function updateUserProfile() {
      if (state.currentUser) {
        const initials = getInitials(state.currentUser.fullname);
        document.getElementById('profileName').textContent = state.currentUser.fullname;
        document.getElementById('profileEmail').textContent = state.currentUser.email;
        document.getElementById('profileLoginEmail').textContent = 'Username: ' + state.currentUser.username;
        
        const savedImage = localStorage.getItem('profileImage_' + state.currentUser.username);
        const avatarDiv = document.getElementById('profileAvatar');
        
        if (savedImage) {
          avatarDiv.style.background = 'none';
          avatarDiv.innerHTML = `<img src="${savedImage}" alt="Profile">`;
        } else {
          avatarDiv.style.background = 'linear-gradient(135deg, #3261e9 0%, #1e3a8a 100%)';
          avatarDiv.innerHTML = `<span id="profileInitials">${initials}</span>`;
        }
      }
    }

    function handleProfileImageUpload(e) {
      const file = e.target.files[0];
      if (!file) return;

      if (!file.type.startsWith('image/')) {
        Swal.fire({
          icon: 'error',
          title: currentLang === 'th' ? '‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á' : 'Invalid file',
          text: currentLang === 'th' ? '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û' : 'Please select an image file',
          confirmButtonColor: '#3261e9'
        });
        return;
      }

      const reader = new FileReader();
      reader.onload = function(event) {
        const imageData = event.target.result;
        
        localStorage.setItem('profileImage_' + state.currentUser.username, imageData);
        
        const avatarDiv = document.getElementById('profileAvatar');
        avatarDiv.style.background = 'none';
        avatarDiv.innerHTML = `<img src="${imageData}" alt="Profile">`;
        
        Swal.fire({
          icon: 'success',
          title: currentLang === 'th' ? '‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à' : 'Upload successful',
          timer: 1500,
          showConfirmButton: false
        });
      };
      
      reader.readAsDataURL(file);
    }

    let jsonpCounter = 0;

    function makeJSONPRequest(params) {
      return new Promise((resolve, reject) => {
        const callbackName = `jsonpCallback_${Date.now()}_${jsonpCounter++}`;
        const script = document.createElement('script');
        const timeout = setTimeout(() => {
          cleanup();
          console.error('REQUEST TIMEOUT after 30 seconds');
          console.error('Parameters:', params);
          reject(new Error('Request timeout'));
        }, 30000);

        window[callbackName] = function(data) {
          clearTimeout(timeout);
          cleanup();
          console.log(`Response received for ${params.action}:`, data);
          resolve(data);
        };

        function cleanup() {
          delete window[callbackName];
          if (script.parentNode) {
            script.parentNode.removeChild(script);
          }
        }

        const queryParams = new URLSearchParams({
          ...params,
          callback: callbackName
        });

        const url = `${CONFIG.APPS_SCRIPT_URL}?${queryParams.toString()}`;
        
        script.src = url;
        script.onerror = () => {
          clearTimeout(timeout);
          cleanup();
          reject(new Error('Script load error'));
        };

        document.head.appendChild(script);
      });
    }

    async function registerUser(fullname, email, username, password) {
      try {
        const ts = generateTimestamp();
        
        const result = await makeJSONPRequest({
          action: 'register',
          fullname: fullname,
          email: email,
          username: username,
          password: password,
          registerDate: ts.date,
          registerTime: ts.time,
          timestamp: ts.timestamp,
          sheetId: CONFIG.SHEET_ID,
          sheetName: CONFIG.USER_SHEET_NAME
        });
        
        updateDebugInfo({
          action: 'register',
          success: result.success,
          message: result.message,
          timestamp: ts.timestamp
        });
        
        return result;
      } catch (error) {
        console.error('=== REGISTER ERROR ===');
        console.error('Error:', error);
        updateDebugInfo({
          action: 'register',
          error: error.message,
          timestamp: generateTimestamp().timestamp
        });
        return { success: false, message: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô', error: error.message };
      }
    }

    async function loginUser(username, password) {
      try {
        const params = {
          action: 'login',
          username: username,
          password: password,
          sheetId: CONFIG.SHEET_ID,
          sheetName: CONFIG.USER_SHEET_NAME
        };
        
        const result = await makeJSONPRequest(params);
        
        return result;
      } catch (error) {
        return { 
          success: false, 
          message: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö',
          error: error.message 
        };
      }
    }

    async function createRoomBooking(bookingData) {
      try {
        const ts = generateTimestamp();
        
        return await makeJSONPRequest({
          action: 'saveBooking',
          ...bookingData,
          createDate: ts.date,
          createTime: ts.time,
          createTimestamp: ts.timestamp,
          sheetId: CONFIG.SHEET_ID,
          sheetName: CONFIG.ROOM_SHEET_NAME
        });
      } catch (error) {
        return { success: false, message: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á', error: error.message };
      }
    }

    async function createAppointment(apptData) {
      try {
        const ts = generateTimestamp();
        
        return await makeJSONPRequest({
          action: 'createAppointment',
          ...apptData,
          date: formatDateToDDMMYYYY(apptData.date),
          createDate: ts.date,
          createTime: ts.time,
          createTimestamp: ts.timestamp,
          sheetId: CONFIG.SHEET_ID,
          sheetName: CONFIG.APPT_SHEET_NAME
        });
      } catch (error) {
        return { success: false, message: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢' };
      }
    }

    async function getAllRoomBookings() {
      try {
        const result = await makeJSONPRequest({
          action: 'getRoomBookings',
          sheetId: CONFIG.SHEET_ID,
          sheetName: CONFIG.ROOM_SHEET_NAME
        });
        console.log('Room Bookings Result:', result);
        return result;
      } catch (error) {
        console.error('Error getting room bookings:', error);
        return { success: false, bookings: [] };
      }
    }

    async function getAllAppointments() {
      try {
        const result = await makeJSONPRequest({
          action: 'getAppointments',
          sheetId: CONFIG.SHEET_ID,
          sheetName: CONFIG.APPT_SHEET_NAME
        });
        console.log('Appointments Result:', result);
        return result;
      } catch (error) {
        console.error('Error getting appointments:', error);
        return { success: false, appointments: [] };
      }
    }

    async function deleteRoomBooking(bookingId) {
      try {
        return await makeJSONPRequest({
          action: 'deleteRoomBooking',
          bookingId: bookingId,
          sheetId: CONFIG.SHEET_ID,
          sheetName: CONFIG.ROOM_SHEET_NAME
        });
      } catch (error) {
        return { success: false, message: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á' };
      }
    }

    async function deleteAppointment(apptId) {
      try {
        return await makeJSONPRequest({
          action: 'deleteAppointment',
          appointmentId: apptId,
          sheetId: CONFIG.SHEET_ID,
          sheetName: CONFIG.APPT_SHEET_NAME
        });
      } catch (error) {
        return { success: false, message: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢' };
      }
    }

    async function logActivity(activityType, details) {
      try {
        const ts = generateTimestamp();
        
        const result = await makeJSONPRequest({
          action: 'logActivity',
          activityType: activityType,
          userName: state.currentUser.fullname,
          userEmail: state.currentUser.email,
          date: ts.date,
          time: ts.time,
          timestamp: ts.timestamp,
          details: details,
          sheetId: CONFIG.SHEET_ID,
          sheetName: CONFIG.ACTIVITY_SHEET_NAME
        });
        
        return result;
      } catch (error) {
        return { success: false };
      }
    }

    async function getAllActivities() {
      try {
        const result = await makeJSONPRequest({
          action: 'getActivities',
          sheetId: CONFIG.SHEET_ID,
          sheetName: CONFIG.ACTIVITY_SHEET_NAME
        });
        console.log('Activities Result:', result);
        return result;
      } catch (error) {
        console.error('Error getting activities:', error);
        return { success: false, activities: [] };
      }
    }

    function showAuthScreen() {
      document.getElementById('authScreen').style.display = 'flex';
      document.getElementById('mainScreen').style.display = 'none';
    }

    function showMainScreen() {
      document.getElementById('authScreen').style.display = 'none';
      document.getElementById('mainScreen').style.display = 'block';
      updateUserProfile();
      loadAllData();
    }

    function toggleAuthMode() {
      state.isRegistering = !state.isRegistering;
      
      const fullnameGroup = document.getElementById('fullnameGroup');
      const emailGroup = document.getElementById('emailGroup');
      const authSubmitBtn = document.getElementById('authSubmitBtn');
      const toggleAuthBtn = document.getElementById('toggleAuthBtn');
      
      if (state.isRegistering) {
        fullnameGroup.classList.remove('hidden');
        emailGroup.classList.remove('hidden');
        authSubmitBtn.setAttribute('data-i18n', 'register');
        toggleAuthBtn.setAttribute('data-i18n', 'login');
        document.getElementById('fullname').required = true;
        document.getElementById('email').required = true;
      } else {
        fullnameGroup.classList.add('hidden');
        emailGroup.classList.add('hidden');
        authSubmitBtn.setAttribute('data-i18n', 'login');
        toggleAuthBtn.setAttribute('data-i18n', 'register');
        document.getElementById('fullname').required = false;
        document.getElementById('email').required = false;
      }
      
      translatePage();
    }

    async function handleAuthSubmit(e) {
      e.preventDefault();
      
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value.trim();
      
      if (!username || !password) {
        await Swal.fire({
          icon: 'warning',
          title: currentLang === 'th' ? '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•' : 'Please fill in all fields',
          confirmButtonColor: '#3261e9'
        });
        return;
      }

      if (state.isRegistering) {
        const fullname = document.getElementById('fullname').value.trim();
        const email = document.getElementById('email').value.trim();
        
        if (!fullname || !email) {
          await Swal.fire({
            icon: 'warning',
            title: currentLang === 'th' ? '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•‡πÅ‡∏•‡∏∞‡∏≠‡∏µ‡πÄ‡∏°‡∏•' : 'Please enter your full name and email',
            confirmButtonColor: '#3261e9'
          });
          return;
        }

        Swal.fire({
          title: currentLang === 'th' ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô...' : 'Registering...',
          allowOutsideClick: false,
          didOpen: () => {
            Swal.showLoading();
          }
        });

        const result = await registerUser(fullname, email, username, password);
        
        if (result.success) {
          await Swal.fire({
            icon: 'success',
            title: currentLang === 'th' ? '‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!' : 'Registration successful!',
            timer: 1500,
            showConfirmButton: false
          });
          
          state.currentUser = { fullname: result.fullname, email: result.email, username: result.username };
          state.isLoggedIn = true;
          showMainScreen();
        } else {
          await Swal.fire({
            icon: 'error',
            title: currentLang === 'th' ? '‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à' : 'Registration failed',
            html: `<div style="text-align: left;"><p><strong>Message:</strong> ${result.message}</p></div>`,
            confirmButtonColor: '#3261e9'
          });
        }
      } else {
        Swal.fire({
          title: currentLang === 'th' ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö...' : 'Logging in...',
          allowOutsideClick: false,
          didOpen: () => {
            Swal.showLoading();
          }
        });

        const result = await loginUser(username, password);
        
        if (result.success) {
          await Swal.fire({
            icon: 'success',
            title: currentLang === 'th' ? '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!' : 'Login successful!',
            timer: 1500,
            showConfirmButton: false
          });
          
          state.currentUser = { fullname: result.fullname, email: result.email, username: result.username };
          state.isLoggedIn = true;
          showMainScreen();
        } else {
          await Swal.fire({
            icon: 'error',
            title: currentLang === 'th' ? '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à' : 'Login failed',
            text: result.message,
            confirmButtonColor: '#3261e9'
          });
        }
      }
    }

    function handleLogout() {
      state.isLoggedIn = false;
      state.currentUser = null;
      document.getElementById('authForm').reset();
      showAuthScreen();
      
      Swal.fire({
        icon: 'success',
        title: currentLang === 'th' ? '‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à' : 'Logout successful',
        timer: 1500,
        showConfirmButton: false
      });
    }

    function handleRoomSelect(e) {
      const card = e.target.closest('.room-card');
      if (!card) return;
      
      document.querySelectorAll('.room-card').forEach(c => c.classList.remove('selected'));
      card.classList.add('selected');
      
      state.selectedRoom = {
        type: card.dataset.room,
        nameTH: card.dataset.nameTh,
        nameEN: card.dataset.nameEn
      };
      
      document.getElementById('roomBookingForm').classList.add('show');
    }

    async function handleRoomBookingSubmit(e) {
      e.preventDefault();
      
      if (!state.selectedRoom) {
        await Swal.fire({
          icon: 'warning',
          title: currentLang === 'th' ? '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á' : 'Please select a room',
          confirmButtonColor: '#3261e9'
        });
        return;
      }

      const date = document.getElementById('roomDate').value;
      const startTime = document.getElementById('roomStartTime').value;
      const endTime = document.getElementById('roomEndTime').value;
      const bookerName = document.getElementById('roomBooker').value.trim();
      const userName = document.getElementById('roomUser').value.trim();
      const notes = document.getElementById('roomNotes').value.trim();

      if (!date || !startTime || !endTime || !bookerName || !userName) {
        await Swal.fire({
          icon: 'warning',
          title: currentLang === 'th' ? '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•' : 'Please fill in all fields',
          confirmButtonColor: '#3261e9'
        });
        return;
      }

      if (startTime >= endTime) {
        await Swal.fire({
          icon: 'warning',
          title: currentLang === 'th' ? '‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á' : 'Invalid time',
          text: currentLang === 'th' ? '‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î' : 'Start time must be before end time',
          confirmButtonColor: '#3261e9'
        });
        return;
      }

      const formattedDate = formatDateToDDMMYYYY(date);
      
      const bookingData = {
        roomType: state.selectedRoom.type,
        roomNameTH: state.selectedRoom.nameTH,
        roomNameEN: state.selectedRoom.nameEN,
        date: formattedDate,
        startTime: formatTimeToHHMM(startTime),
        endTime: formatTimeToHHMM(endTime),
        bookerName: bookerName,
        userName: userName,
        userEmail: state.currentUser.email,
        notes: notes
      };

      Swal.fire({
        title: currentLang === 'th' ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...' : 'Saving...',
        allowOutsideClick: false,
        didOpen: () => {
          Swal.showLoading();
        }
      });

      const result = await createRoomBooking(bookingData);

       Swal.close();


      if (result.success) {
        const activityDetails = `${currentLang === 'en' ? bookingData.roomNameEN : bookingData.roomNameTH} - ${formatDateToDDMMYYYY(bookingData.date)} ${bookingData.startTime}-${bookingData.endTime}`;
        logActivity('room_booking_created', activityDetails);

        Swal.fire({
          icon: 'success',
          title: currentLang === 'th' ? '‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!' : 'Booking successful!',
          timer: 1500,
          showConfirmButton: false
        });

        document.getElementById('roomBookingForm').reset();
        document.querySelectorAll('.room-card').forEach(c => c.classList.remove('selected'));
        document.getElementById('roomBookingForm').classList.remove('show');
        state.selectedRoom = null;

        loadAllData();
      } else {
        await Swal.fire({
          icon: 'error',
          title: currentLang === 'th' ? '‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à' : 'Booking failed',
          text: result.message,
          confirmButtonColor: '#3261e9'
        });
      }
    }

    async function handleAppointmentSubmit(e) {
      e.preventDefault();

      const date = document.getElementById('apptDate').value;
      const time = document.getElementById('apptTime').value;
      const visitorName = document.getElementById('visitorName').value.trim();
      const visitorCompany = document.getElementById('visitorCompany').value.trim();
      const contactPerson = document.getElementById('contactPerson').value.trim();
      const notes = document.getElementById('apptNotes').value.trim();

      if (!date || !time || !visitorName || !visitorCompany || !contactPerson) {
        await Swal.fire({
          icon: 'warning',
          title: currentLang === 'th' ? '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•' : 'Please fill in all fields',
          confirmButtonColor: '#3261e9'
        });
        return;
      }

      const apptData = {
        date: date,
        time: formatTimeToHHMM(time),
        visitorName: visitorName,
        visitorCompany: visitorCompany,
        contactPerson: contactPerson,
        userEmail: state.currentUser.email,
        notes: notes
      };

      Swal.fire({
        title: currentLang === 'th' ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...' : 'Saving...',
        allowOutsideClick: false,
        didOpen: () => {
          Swal.showLoading();
        }
      });

      const result = await createAppointment(apptData);

      if (result.success) {
        const activityDetails = `${apptData.visitorName} - ${formatDateToDDMMYYYY(apptData.date)} ${apptData.time}`;
       logActivity('appointment_created', activityDetails);

        Swal.fire({
          icon: 'success',
          title: currentLang === 'th' ? '‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!' : 'Appointment created!',
          timer: 1500,
          showConfirmButton: false
        });

        document.getElementById('appointmentForm').reset();
        loadAllData();
      } else {
        await Swal.fire({
          icon: 'error',
          title: currentLang === 'th' ? '‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à' : 'Appointment failed',
          text: result.message,
          confirmButtonColor: '#3261e9'
        });
      }
    }

    async function handleCancelRoomBooking(bookingId) {
      const result = await Swal.fire({
        icon: 'warning',
        title: currentLang === 'th' ? '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å' : 'Confirm cancellation',
        text: currentLang === 'th' ? '‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?' : 'Do you want to cancel this booking?',
        showCancelButton: true,
        confirmButtonColor: '#ef4444',
        cancelButtonColor: '#3261e9',
        confirmButtonText: currentLang === 'th' ? '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å' : 'Cancel',
        cancelButtonText: currentLang === 'th' ? '‡πÑ‡∏°‡πà‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å' : 'No'
      });

      if (result.isConfirmed) {
        Swal.fire({
          title: currentLang === 'th' ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å...' : 'Cancelling...',
          allowOutsideClick: false,
          didOpen: () => {
            Swal.showLoading();
          }
        });

        const deleteResult = await deleteRoomBooking(bookingId);

        if (deleteResult.success) {
          const booking = state.roomBookings.find(b => b.id === bookingId);
          if (booking) {
            const activityDetails = `${currentLang === 'en' ? booking.roomNameEN : booking.roomNameTH} - ${formatDateToDDMMYYYY(booking.date)} ${formatTimeToHHMM(booking.startTime)}-${formatTimeToHHMM(booking.endTime)}`;
            logActivity('room_booking_cancelled', activityDetails);
          }

          Swal.close();

          await Swal.fire({
            icon: 'success',
            title: currentLang === 'th' ? '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à' : 'Cancelled successfully',
            timer: 1500,
            showConfirmButton: false
          });

          await loadAllData();
        } else {
          Swal.close();

          await Swal.fire({
            icon: 'error',
            title: currentLang === 'th' ? '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à' : 'Cancellation failed',
            confirmButtonColor: '#3261e9'
          });
        }
      }
    }

    async function handleCancelAppointment(apptId) {
      const result = await Swal.fire({
        icon: 'warning',
        title: currentLang === 'th' ? '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å' : 'Confirm cancellation',
        text: currentLang === 'th' ? '‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?' : 'Do you want to cancel this appointment?',
        showCancelButton: true,
        confirmButtonColor: '#ef4444',
        cancelButtonColor: '#3261e9',
        confirmButtonText: currentLang === 'th' ? '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å' : 'Cancel',
        cancelButtonText: currentLang === 'th' ? '‡πÑ‡∏°‡πà‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å' : 'No'
      });

      if (result.isConfirmed) {
        Swal.fire({
          title: currentLang === 'th' ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å...' : 'Cancelling...',
          allowOutsideClick: false,
          didOpen: () => {
            Swal.showLoading();
          }
        });

        const deleteResult = await deleteAppointment(apptId);

        if (deleteResult.success) {
          const appt = state.appointments.find(a => a.id === apptId);
          if (appt) {
            const activityDetails = `${appt.visitorName} - ${formatDateToDDMMYYYY(appt.date)} ${formatTimeToHHMM(appt.time)}`;
            logActivity('appointment_cancelled', activityDetails);
          }

          Swal.fire({
            icon: 'success',
            title: currentLang === 'th' ? '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à' : 'Cancelled successfully',
            timer: 1500,
            showConfirmButton: false
          });

          loadAllData();
        } else {
          await Swal.fire({
            icon: 'error',
            title: currentLang === 'th' ? '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à' : 'Cancellation failed',
            confirmButtonColor: '#3261e9'
          });
        }
      }
    }

    async function loadAllData() {
      console.log('Loading all data...');
      
      const [roomResult, apptResult, activityResult] = await Promise.all([
    	 getAllRoomBookings(),
         getAllAppointments(),
         getAllActivities()
  ]);      

      console.log('Room Result:', roomResult);
      console.log('Appointment Result:', apptResult);
      console.log('Activity Result:', activityResult);

      if (roomResult.success) {
        state.roomBookings = roomResult.bookings || [];
        console.log('Room bookings loaded:', state.roomBookings.length);
      } else {
        console.log('Room bookings failed to load');
        state.roomBookings = [];
      }

      if (apptResult.success) {
        state.appointments = apptResult.appointments || [];
        console.log('Appointments loaded:', state.appointments.length);
      } else {
        console.log('Appointments failed to load');
        state.appointments = [];
      }

      if (activityResult.success) {
        state.activities = activityResult.activities || [];
        console.log('Activities loaded:', state.activities.length);
      } else {
        console.log('Activities failed to load');
        state.activities = [];
      }

      renderTodayRoomBookings();
      renderTodayAppointments();
      renderUserActivities();
    }

    async function loadAllBookings() {
      console.log('Loading all bookings...');
      
      // Reload fresh data from server
      const [roomResult, apptResult] = await Promise.all([
    	getAllRoomBookings(),
    	getAllAppointments()
  ]);
      
      console.log('Fresh room result:', roomResult);
      console.log('Fresh appointment result:', apptResult);
      
      if (roomResult.success) {
        state.roomBookings = roomResult.bookings || [];
        console.log('Room bookings reloaded:', state.roomBookings.length);
      } else {
    console.log('Room bookings failed to reload');
    state.roomBookings = [];
  }
      
      if (apptResult.success) {
        state.appointments = apptResult.appointments || [];
        console.log('Appointments reloaded:', state.appointments.length);
       } else {
    	console.log('Appointments failed to reload');
    	state.appointments = [];
  }
      

      console.log('Current state after reload:', {
        roomBookings: state.roomBookings.length,
        appointments: state.appointments.length
      });
      
      renderAllBookings();
      renderFullscreenView();
    }

    function toggleFullscreen() {
       const fullscreenEl = document.getElementById('fullscreenView');
       fullscreenEl.classList.add('active');
       renderFullscreenView();
}

    function closeFullscreen() {
      const fullscreenEl = document.getElementById('fullscreenView');
      fullscreenEl.classList.remove('active');
}

    async function switchTab(tabName) {
      document.querySelectorAll('.nav-item').forEach(btn => {
        btn.classList.remove('active');
      });
      document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
      
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });
      
      const tabMap = {
        'room-booking': 'roomBookingTab',
        'appointment': 'appointmentTab',
        'all-bookings': 'allBookingsTab',
        'user-activity': 'userActivityTab',
        'user-history': 'userHistoryTab'
      };
      
      const tabId = tabMap[tabName];
      if (tabId) {
        document.getElementById(tabId).classList.add('active');
      }

      if (tabName === 'all-bookings') {
        console.log('Switching to all-bookings tab - loading fresh data');
        await loadAllBookings();
        console.log('Data loaded, now rendering');
        renderAllBookings();
        renderFullscreenView();
      } else if (tabName === 'user-history') {
        updateUserProfile();
      } else if (tabName === 'user-activity') {
        const activityResult = await getAllActivities();
        if (activityResult.success) {
          state.activities = activityResult.activities || [];
        }
        renderUserActivities();
      } else if (tabName === 'room-booking') {
        console.log('Switching to room-booking tab');
        const roomResult = await getAllRoomBookings();
        if (roomResult.success) {
          state.roomBookings = roomResult.bookings || [];
        }
        renderTodayRoomBookings();
      } else if (tabName === 'appointment') {
        console.log('Switching to appointment tab');
        const apptResult = await getAllAppointments();
        if (apptResult.success) {
          state.appointments = apptResult.appointments || [];
          console.log('Appointments loaded for tab:', state.appointments.length);
        }
        renderTodayAppointments();
      }
    }

    function renderTodayRoomBookings() {
      const container = document.getElementById('todayRoomBookings');
      
      if (state.roomBookings.length === 0) {
        container.innerHTML = `
          <div class="no-bookings">
            <p data-i18n="noRoomBookings">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</p>
          </div>
        `;
        translatePage();
        return;
      }

      container.innerHTML = state.roomBookings.map(booking => `
        <div class="booking-item">
          <div class="booking-header">
            <div class="booking-room">${currentLang === 'en' ? booking.roomNameEN : booking.roomNameTH}</div>
            <div class="booking-time">${formatDateToDDMMYYYY(booking.date)} ${formatTimeToHHMM(booking.startTime)} - ${formatTimeToHHMM(booking.endTime)}</div>
          </div>
          <div class="booking-details">
            <div class="booking-detail-item">
              <strong>${translations[currentLang].bookerName}:</strong>
              <span>${booking.bookerName}</span>
            </div>
            <div class="booking-detail-item">
              <strong>${translations[currentLang].userName}:</strong>
              <span>${booking.userName}</span>
            </div>
            ${booking.notes ? `
            <div class="booking-detail-item">
              <strong>${translations[currentLang].notes}:</strong>
              <span>${booking.notes}</span>
            </div>
            ` : ''}
          </div>
          <button class="btn-cancel" onclick="handleCancelRoomBooking('${booking.id}')" data-i18n="cancel">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        </div>
      `).join('');
      translatePage();
    }

    function renderTodayAppointments() {
      const container = document.getElementById('todayAppointments');
      
      console.log('Rendering today appointments...');
      console.log('Total appointments to render:', state.appointments.length);
      console.log('Appointments data:', state.appointments);
      
      if (!state.appointments || state.appointments.length === 0) {
        console.log('No appointments found, showing empty message');
        container.innerHTML = `
          <div class="no-bookings">
            <p data-i18n="noAppointments">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢</p>
          </div>
        `;
        translatePage();
        return;
      }

      console.log('Rendering', state.appointments.length, 'appointments');
      container.innerHTML = state.appointments.map((appt, index) => {
        console.log(`Rendering appointment ${index + 1}:`, appt);
        return `
        <div class="booking-item">
          <div class="booking-header">
            <div class="booking-room">${appt.visitorName || '-'}</div>
            <div class="booking-time">${formatDateToDDMMYYYY(appt.date)} ${formatTimeToHHMM(appt.time)}</div>
          </div>
          <div class="booking-details">
            <div class="booking-detail-item">
              <strong>${translations[currentLang].visitorCompany}:</strong>
              <span>${appt.visitorCompany || '-'}</span>
            </div>
            <div class="booking-detail-item">
              <strong>${translations[currentLang].contactPerson}:</strong>
              <span>${appt.contactPerson || '-'}</span>
            </div>
            ${appt.notes ? `
            <div class="booking-detail-item">
              <strong>${translations[currentLang].notes}:</strong>
              <span>${appt.notes}</span>
            </div>
            ` : ''}
          </div>
          <button class="btn-cancel" onclick="handleCancelAppointment('${appt.id}')" data-i18n="cancel">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        </div>
      `;
      }).join('');
      console.log('Appointments rendered successfully');
      translatePage();
    }

    function renderAllBookings() {
      const roomContainer = document.getElementById('allRoomBookingsList');
      if (state.roomBookings.length === 0) {
        roomContainer.innerHTML = `
          <div class="no-bookings">
            <p data-i18n="noRoomBookings">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</p>
          </div>
        `;
      } else {
        roomContainer.innerHTML = state.roomBookings.map(booking => `
          <div class="booking-item">
            <div class="booking-header">
              <div class="booking-room">${currentLang === 'en' ? booking.roomNameEN : booking.roomNameTH}</div>
              <div class="booking-time">${formatDateToDDMMYYYY(booking.date)} ${formatTimeToHHMM(booking.startTime)}-${formatTimeToHHMM(booking.endTime)}</div>
            </div>
            <div class="booking-details">
              <div class="booking-detail-item">
                <strong>${translations[currentLang].bookerName}:</strong>
                <span>${booking.bookerName}</span>
              </div>
              <div class="booking-detail-item">
                <strong>${translations[currentLang].userName}:</strong>
                <span>${booking.userName}</span>
              </div>
              ${booking.notes ? `
              <div class="booking-detail-item">
                <strong>${translations[currentLang].notes}:</strong>
                <span>${booking.notes}</span>
              </div>
              ` : ''}
            </div>
            <button class="btn-cancel" onclick="handleCancelRoomBooking('${booking.id}')" data-i18n="cancel">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
          </div>
        `).join('');
      }

      const apptContainer = document.getElementById('allAppointmentsList');
      if (state.appointments.length === 0) {
        apptContainer.innerHTML = `
          <div class="no-bookings">
            <p data-i18n="noAppointments">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢</p>
          </div>
        `;
      } else {
        apptContainer.innerHTML = state.appointments.map(appt => `
          <div class="booking-item">
            <div class="booking-header">
              <div class="booking-room">${appt.visitorName}</div>
              <div class="booking-time">${formatDateToDDMMYYYY(appt.date)} ${formatTimeToHHMM(appt.time)}</div>
            </div>
            <div class="booking-details">
              <div class="booking-detail-item">
                <strong>${translations[currentLang].visitorCompany}:</strong>
                <span>${appt.visitorCompany}</span>
              </div>
              <div class="booking-detail-item">
                <strong>${translations[currentLang].contactPerson}:</strong>
                <span>${appt.contactPerson}</span>
              </div>
              ${appt.notes ? `
              <div class="booking-detail-item">
                <strong>${translations[currentLang].notes}:</strong>
                <span>${appt.notes}</span>
              </div>
              ` : ''}
            </div>
            <button class="btn-cancel" onclick="handleCancelAppointment('${appt.id}')" data-i18n="cancel">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
          </div>
        `).join('');
      }

      translatePage();
    }

    function renderFullscreenView() {
      const roomContainer = document.getElementById('fullscreenRoomBookings');
      if (state.roomBookings.length === 0) {
        roomContainer.innerHTML = `
          <div class="no-bookings">
            <p data-i18n="noRoomBookings">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</p>
          </div>
        `;
      } else {
        roomContainer.innerHTML = state.roomBookings.map(booking => `
          <div class="booking-item">
            <div class="booking-header">
              <div class="booking-room">${currentLang === 'en' ? booking.roomNameEN : booking.roomNameTH}</div>
              <div class="booking-time">${formatDateToDDMMYYYY(booking.date)} ${formatTimeToHHMM(booking.startTime)}-${formatTimeToHHMM(booking.endTime)}</div>
            </div>
            <div class="booking-details">
              <div class="booking-detail-item">
                <strong>${translations[currentLang].bookerName}:</strong>
                <span>${booking.bookerName}</span>
              </div>
              <div class="booking-detail-item">
                <strong>${translations[currentLang].userName}:</strong>
                <span>${booking.userName}</span>
              </div>
            </div>
          </div>
        `).join('');
      }

      const apptContainer = document.getElementById('fullscreenAppointments');
      if (state.appointments.length === 0) {
        apptContainer.innerHTML = `
          <div class="no-bookings">
            <p data-i18n="noAppointments">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢</p>
          </div>
        `;
      } else {
        apptContainer.innerHTML = state.appointments.map(appt => `
          <div class="booking-item">
            <div class="booking-header">
              <div class="booking-room">${appt.visitorName}</div>
              <div class="booking-time">${formatDateToDDMMYYYY(appt.date)} ${formatTimeToHHMM(appt.time)}</div>
            </div>
            <div class="booking-details">
              <div class="booking-detail-item">
                <strong>${translations[currentLang].visitorCompany}:</strong>
                <span>${appt.visitorCompany}</span>
              </div>
              <div class="booking-detail-item">
                <strong>${translations[currentLang].contactPerson}:</strong>
                <span>${appt.contactPerson}</span>
              </div>
            </div>
          </div>
        `).join('');
      }

      translatePage();
    }

    function renderUserActivities() {
      const container = document.getElementById('userActivityList');
      
      if (!container) return;

      if (state.activities.length === 0) {
        container.innerHTML = `
          <div class="no-bookings">
            <p data-i18n="noActivity">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</p>
          </div>
        `;
        translatePage();
        return;
      }

      const activityLabels = {
        'room_booking_created': currentLang === 'th' ? '‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°' : 'Created room booking',
        'appointment_created': currentLang === 'th' ? '‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢' : 'Created appointment',
        'room_booking_cancelled': currentLang === 'th' ? '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°' : 'Cancelled room booking',
        'appointment_cancelled': currentLang === 'th' ? '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢' : 'Cancelled appointment'
      };

      let html = '';
      state.activities.forEach(activity => {
        // Convert ISO timestamp (2026-01-05T08:52:47.000Z) to readable format (dd-MM-yyyy HH:mm:ss)
        const displayTime = formatISOTimestamp(activity.timestamp);
        
        html += `
        <div class="booking-item">
          <div class="booking-header">
            <div class="booking-room">${activityLabels[activity.activityType] || activity.activityType}</div>
            <div class="booking-time">${displayTime}</div>
          </div>
          <div class="booking-details">
            <div class="booking-detail-item">
              <strong>${translations[currentLang].activityBy}:</strong>
              <span>${activity.userName}</span>
            </div>
            ${activity.details ? `
            <div class="booking-detail-item">
              <strong>${translations[currentLang].notes}:</strong>
              <span>${translateActivityDetails(activity.details)}</span>
            </div>
            ` : ''}
          </div>
        </div>
      `;
      });
      
      container.innerHTML = html;
      translatePage();
    }

    async function checkAutoLogin() {
      localStorage.removeItem('isLoggedIn');
      localStorage.removeItem('currentUser');
      state.isLoggedIn = false;
      state.currentUser = null;
      showAuthScreen();
    }

    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('authForm').addEventListener('submit', handleAuthSubmit);
      document.getElementById('toggleAuthBtn').addEventListener('click', toggleAuthMode);
      document.getElementById('logoutBtn').addEventListener('click', handleLogout);

      document.getElementById('langToggleAuth').addEventListener('click', () => {
        currentLang = currentLang === 'th' ? 'en' : 'th';
        
        const toggleAuth = document.getElementById('langToggleAuth');
        const langOptions = toggleAuth.querySelectorAll('.lang-option');
        
        if (currentLang === 'en') {
          toggleAuth.classList.add('en');
          langOptions.forEach(opt => {
            if (opt.getAttribute('data-lang') === 'en') {
              opt.classList.add('active');
            } else {
              opt.classList.remove('active');
            }
          });
        } else {
          toggleAuth.classList.remove('en');
          langOptions.forEach(opt => {
            if (opt.getAttribute('data-lang') === 'th') {
              opt.classList.add('active');
            } else {
              opt.classList.remove('active');
            }
          });
        }
        
        translatePage();
      });

      document.getElementById('langToggle').addEventListener('click', () => {
        currentLang = currentLang === 'th' ? 'en' : 'th';
        
        const toggleMain = document.getElementById('langToggle');
        const langOptions = toggleMain.querySelectorAll('.lang-option');
        
        if (currentLang === 'en') {
          toggleMain.classList.add('en');
          langOptions.forEach(opt => {
            if (opt.getAttribute('data-lang') === 'en') {
              opt.classList.add('active');
            } else {
              opt.classList.remove('active');
            }
          });
        } else {
          toggleMain.classList.remove('en');
          langOptions.forEach(opt => {
            if (opt.getAttribute('data-lang') === 'th') {
              opt.classList.add('active');
            } else {
              opt.classList.remove('active');
            }
          });
        }
        
        translatePage();
        
        renderTodayRoomBookings();
        renderTodayAppointments();
        renderAllBookings();
        renderFullscreenView();
        renderUserActivities();
      });

      document.querySelectorAll('.nav-item').forEach(btn => {
        btn.addEventListener('click', async () => {
          await switchTab(btn.dataset.tab);
        });
      });

      document.getElementById('roomSelector').addEventListener('click', handleRoomSelect);

      document.getElementById('roomBookingForm').addEventListener('submit', handleRoomBookingSubmit);
      document.getElementById('appointmentForm').addEventListener('submit', handleAppointmentSubmit);

      document.getElementById('fullscreenBtn').addEventListener('click', toggleFullscreen);
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          closeFullscreen();
        }
      });

      populateTimeOptions();

      document.getElementById('roomStartTimeSelect').addEventListener('change', (e) => {
        if (e.target.value) {
          document.getElementById('roomStartTime').value = e.target.value;
        }
      });

      document.getElementById('roomEndTimeSelect').addEventListener('change', (e) => {
        if (e.target.value) {
          document.getElementById('roomEndTime').value = e.target.value;
        }
      });

      document.getElementById('apptTimeSelect').addEventListener('change', (e) => {
        if (e.target.value) {
          document.getElementById('apptTime').value = e.target.value;
        }
      });

      const today = getCurrentDateGMT7();
      document.getElementById('roomDate').min = today;
      document.getElementById('apptDate').min = today;

      document.getElementById('profileImageInput').addEventListener('change', handleProfileImageUpload);

      translatePage();
      checkAutoLogin();
    });

    window.handleCancelRoomBooking = handleCancelRoomBooking;
    window.handleCancelAppointment = handleCancelAppointment;
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9ba2d0f307d94b94',t:'MTc2Nzc4MjIwOC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
